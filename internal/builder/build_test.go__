package builder_test

import (
	"joelmoss/proscenium/internal/builder"
	"os"
	"path"

	"github.com/evanw/esbuild/pkg/api"
	. "github.com/onsi/ginkgo/v2"
	. "github.com/onsi/gomega"
)

var _ = Describe("Internal/Builder/Build", func() {
	var cwd, _ = os.Getwd()
	var root string = path.Join(cwd, "../", "test", "internal")

	build := func(path string) api.BuildResult {
		return builder.Build(builder.BuildOptions{
			Path: path,
			Root: root,
			Env:  2,
		})
	}

	It("should fail on unknown entrypoint", func() {
		result := build("unknown.js")

		Expect(result.Errors[0].Text).To(Equal("Could not resolve \"unknown.js\""))
	})
})
